# Техническое задание 
## «Веб-сервис расчёта оптимальных условий астрофотографии для любителей с целью выбора даты и времени съёмки»

---

## 1. Цель проекта

Разработка веб-сервиса, предназначенного для любителей астрофотографии, который помогает выбрать оптимальные дату и время съёмки астрономических объектов на основе анализа астрономических и метеорологических данных.

Сервис автоматически рассчитывает параметры видимости выбранного объекта (высота над горизонтом, фаза и положение Луны, этапы сумерек) и объединяет их с прогнозом погоды (облачность, осадки, видимость), формируя рейтинг временных интервалов, наиболее подходящих для съёмки.

---

## 2. Целевая аудитория и роли пользователей

**Целевая аудитория:**  
Любители астрофотографии начального и среднего уровня, не обладающие глубокими знаниями астрономических расчётов, но желающие получать практические рекомендации для планирования съёмок.

**Роли пользователей:**

- **Гость**
  - Просмотр информации о сервисе
  - Использование демо-планировщика без сохранения данных

- **Зарегистрированный пользователь**
  - Создание и управление локациями съёмки
  - Создание и управление целями съёмки
  - Создание планов съёмки
  - Просмотр результатов расчёта и аналитических графиков

- **Администратор**
  - Управление всеми моделями через Django Admin
  - Контроль данных и корректности работы сервиса

---

## 3. Схема данных (модели)

### 3.1 Location (Локация съёмки)
Хранит информацию о географическом положении пользователя.

**Поля:**
- `name` - название локации
- `latitude` - широта
- `longitude` - долгота
- `timezone` - часовой пояс
- `owner` - связь с пользователем (ForeignKey)

---

### 3.2 Target (Цель съёмки)
Описывает астрономический объект, который пользователь планирует снимать.

**Поля:**
- `name` - название объекта
- `target_type` - тип объекта (Moon / Planet / DSO / MilkyWay)
- `right_ascension` - прямое восхождение (для DSO)
- `declination` - склонение (для DSO)
- `owner` - связь с пользователем (ForeignKey)

---

### 3.3 SessionRequest (План съёмки)
Сущность, объединяющая локацию, цель и параметры планирования.

**Поля:**
- `user` - пользователь
- `location` - связь с Location
- `target` - связь с Target
- `date_from` - начало периода планирования
- `date_to` - конец периода планирования
- `min_target_altitude` - минимально допустимая высота объекта
- `max_cloud_cover` - максимально допустимая облачность
- `avoid_moon` - учитывать влияние Луны
- `created_at` - дата создания

---

### 3.4 ForecastHour (Погодные данные)
Кэш почасовых метеорологических данных для конкретной локации.

**Поля:**
- `location` - связь с Location
- `timestamp` - дата и время прогноза
- `cloud_cover` - облачность (%)
- `precipitation` - осадки
- `visibility` - видимость
- `source` - источник данных

---

### 3.5 AstroWindow (Окно съёмки)
Результат аналитического расчёта - временной интервал, подходящий для съёмки.

**Поля:**
- `plan` - связь с SessionRequest
- `start_time` - начало окна
- `end_time` - конец окна
- `score` - итоговая оценка качества условий
- `avg_cloud_cover` - средняя облачность
- `moon_illumination` - освещённость Луны
- `max_target_altitude` - максимальная высота объекта
- `is_astronomical_dark` - признак астрономической ночи

---

## 4. Основные сценарии пользователя (User Stories)

1. Пользователь регистрируется и добавляет свою локацию съёмки (координаты и название).
2. Пользователь создаёт цель съёмки (например, галактику или Млечный путь).
3. Пользователь задаёт план съёмки, выбирая цель, локацию и диапазон дат.
4. Система автоматически:
   - получает прогноз погоды,
   - рассчитывает положение Солнца, Луны и цели,
   - оценивает каждый временной интервал,
   - формирует список оптимальных окон съёмки.
5. Пользователь просматривает таблицу лучших окон и графики качества условий по времени.

---

## 5. Алгоритм расчёта и аналитика

### 5.1 Астрономические расчёты
С использованием библиотеки **AstroPy** рассчитываются:
- высота Солнца для определения этапов сумерек;
- фаза и положение Луны;
- высота цели над горизонтом в каждый момент времени.

### 5.2 Погодная интеграция
Через внешний API (Open-Meteo) загружаются почасовые данные:
- облачность;
- осадки;
- видимость.

Данные сохраняются в базе и используются повторно

### 5.3 Итог
Для каждого часа вычисляется интегральный показатель качества условий:
- -score = 100
- -0.8 × cloud_cover
- -moon_penalty
+ +altitude_bonus
+ +darkness_bonus

Где:
- `moon_penalty` зависит от фазы и высоты Луны
- `altitude_bonus` растёт при увеличении высоты цели
- `darkness_bonus` добавляется при астрономической ночи

Часы с высоким score объединяются в последовательные временные окна

---

## 6. Технический стек и интеграции

**Backend:**
- Python 3.x
- Django 4.x

**База данных:**
- SQLite (локально)
- PostgreSQL (production)

**Аналитика и расчёты:**
- AstroPy
- Pandas (агрегация и статистика)

**Внешние API:**
- Open-Meteo (погодные данные)

**Frontend:**
- Bootstrap 5
- Chart.js
